<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Personal - Start Bootstrap Template</title>
    <!-- Favicon-->
    <!-- Custom Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/detail-style.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/star.css">
</head>
<body class="d-flex flex-column h-100 bg-light">
<main class="flex-shrink-0">
    <!-- Page Content-->
    <div class="container px-5 my-5">
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bolder mb-0" th:text="${article.hotelName}"></h1>
        </div>
        <div class="row gx-5 justify-content-center">
            <div>
                <!-- Experience Section-->
                <section>
                    <div >
                        <h2 class="text-primary fw-bolder mb-0"></h2>
                        <!-- Download resume button-->
                        <!-- Note: Set the link href target to a PDF file within your project-->
                        <div class="delete-update">


                        </div>
                    </div>
                </section>

                <!-- Divider-->
                <div class="pb-5"></div>
                <!-- Skills Section-->
                <section>
                    <!-- Skillset Card-->
                    <div class="card shadow border-0 rounded-4 mb-5">
                        <div class="card-body p-5">
                            <!-- Professional skills list-->
                            <div class="mb-5">
                                <div class="row row-cols-1 row-cols-md-2">
                                    <div class="text-secondary fw-bolder "><div>No.</div></div>
                                    <div class="text-secondary fw-bolder "><div>CityName </div></div>
                                </div>
                                <div class="row row-cols-1 row-cols-md-2">
                                    <div class="col mb-4 mb-md-0"><div class="d-flex align-items-center bg-light rounded-4 p-3 h-100 hotel-id" th:text="${article.id}"></div></div>
                                    <div class="col mb-4 mb-md-0"><div class="d-flex align-items-center bg-light rounded-4 p-3 h-100"th:text="${article.cityName}"></div></div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <div class="row row-cols-1 row-cols-md-3">
                                    <div class="text-secondary fw-bolder "><div>Tel. </div></div>
                                    <div class="text-secondary fw-bolder "><div>Adress </div></div>
                                    <div class="text-secondary fw-bolder "><div>Rating </div></div>
                                </div>
                                <div class="row row-cols-1 row-cols-md-3">
                                    <div class="col mb-4 mb-md-0"><div class="d-flex align-items-center bg-light rounded-4 p-3 h-100" th:text="${article.tellNumber}"></div></div>
                                    <div class="col mb-4 mb-md-0"><div class="d-flex align-items-center bg-light rounded-4 p-3 h-100" th:text="${article.address}"></div></div>
                                    <div class="col mb-4 mb-md-0"><div class="d-flex align-items-center bg-light rounded-4 p-3 h-100" th:text="(${article.ratingAvg}==0.0)? '-' : ${article.ratingAvg}"></div></div>
                                </div>

                            </div>

                        </div>
                    </div>
                </section>

                <!--호텔 지도-->
                <h2 class="text-secondary fw-bolder mb-4">Map</h2>
                <section>
                    <!-- Skillset Card-->
                    <div class="card shadow border-0 rounded-4 mb-5">
                        <div class="card-body p-0">
                            <div id="map" class="p-5" style="width: 100%; height: 400px; boer-radius: 40px;"></div>
                        </div>
                    </div>

                </section>

                <!--호텔 이미지-->
                <h2 class="text-secondary fw-bolder mb-4">Image</h2>
                <section class="image">
                    <!-- Skillset Card지-->

                </section>

                <!--호텔 예약-->
                <h2 class="text-secondary fw-bolder mb-4">Reservation</h2>
                <section>
                    <!-- Skillset Card-->
                    <div class="card shadow border-0 rounded-4 mb-5">
                        <div class="card-body p-5">
                            <label for="checkIn">체크인 날짜:</label>
                            <input class="checkIn" type="date" id="checkIn" name="checkIn"
                                   th:value="${checkIn}" required>
                            <label for="checkOut">체크아웃 날짜:</label>
                            <input class="checkOut" type="date" id="checkOut" name="checkOut"
                                   th:value="${checkOut}" required>
                            <button class="checkButton">객실 조회</button>

                            <div class="container room-check"></div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- Education Section-->
            <section>
                <h2 class="text-secondary fw-bolder mb-4">Review</h2>
                <!-- Education Card 1-->

                <div class="card shadow border-0 rounded-4 mb-5">
                    <div class="card-body p-5">
                        <form class="mb-3" name="myform" id="myform" method="post" th:action="@{/hotel/review/save(hotelId=${article.id})}">
                            <fieldset>
                                <span class="text-bold">별점을 선택해주세요</span>
                                <input type="radio" name="rating" value=5 id="rate1"><label
                                    for="rate1">⭐️</label>
                                <input type="radio" name="rating" value=4 id="rate2"><label
                                    for="rate2">⭐️</label>
                                <input type="radio" name="rating" value=3 id="rate3"><label
                                    for="rate3">⭐️</label>
                                <input type="radio" name="rating" value=2 id="rate4"><label
                                    for="rate4">⭐️</label>
                                <input type="radio" name="rating" value=1 id="rate5"><label
                                    for="rate5">⭐️</label>
                            </fieldset>
                            <input class="form-control" placeholder="리뷰를 입력하세요 " name="reviewContent" type="text">
                            <button class="btn btn-primary" type="submit">리뷰 작성</button>
                        </form>


                        <table class="table table-striped">
                            <thead class="thead-dark">
                            <tr>
                                <th>id</th>
                                <th>Review Content</th>
                                <th>Review Writer</th>
                                <th>Created Date</th>
                                <th>Modified Date</th>
                                <th>평점</th>
                                <th></th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="review:${article.reviews}">
                                <td th:text="${review.id}"></td>
                                <td th:text="${review.reviewContent}"></td>
                                <td th:text="${review.reviewWriter}"></td>
                                <td th:text="${review.createdDate}"></td>
                                <td th:text="${review.modifiedDate}"></td>
                                <td th:text="${review.rating}"></td>
                                <td><a th:href="@{/hotel/review/delete/(id=${review.id},hotelid=${article.id})}">댓글 삭제</a></td>
                                <td><a th:href="@{/hotel/review/update(id=${review.id})}">댓글 수정</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>



        </div>
    </div>
</main>
<!-- Footer-->
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/detail-scripts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=	2858a9737134fdb246117b738bcfffec"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


<script th:inline="javascript">  //여기서 요청 넣는 거에요 저 메소드에
let imageList = [[ ${image.name}]]
let latitude = [[${article.latitude}]]
let longitude = [[${article.longitude}]]
console.log(latitude)
console.log(longitude)

if (imageList != null) {

    for (const name of imageList) {
        const imgSrc = "/view?fileName=" + name
        $('.image').append(`
                    <div class="card shadow border-0 rounded-4 mb-5">
                        <div class="card-body p-5">
                            <img src='${imgSrc}' width="100%" height="750" style="margin: 10px;"/>

                        </div>
                    </div>

                    `)
    }
}

let hotelWriter =[[${writer}]]
let id=[[${article.id}]]

const updateSrc = "/hotel/update?id=" + id;
const deleteSrc = "/hotel/delete?id=" + id;

if (hotelWriter) {
    $('.delete-update').append(`
    <button type="button" class="btn btn-dark" onclick="location.href='${deleteSrc}'">글 삭제</button>
    <button type="button" class="btn btn-warning" onclick="location.href='${updateSrc}'">글 수정</button>

  `);
    console.log(updateSrc)
}

</script>
<script>

    var container = document.getElementById('map');
    var options = {
        center: new kakao.maps.LatLng(latitude, longitude),
        level: 3
    };

    var map = new kakao.maps.Map(container, options);

    var markerPosition = new kakao.maps.LatLng(latitude, longitude);

    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        position: markerPosition
    });

    // 마커가 지도 위에 표시되도록 설정합니다
    marker.setMap(map);

    document.querySelector(".checkButton").addEventListener("click", async function (e){
        const data = 0;
        try {
            const response = await gettest();
            for(const dto of response){
                $(`.room-check`).append(`<div class="row justify-content-center mt-5">
                      <div class="col-10">
                        <div class="card">
                          <div class="card-body text-center">
                            <h5 class="card-title">객실 정보</h5>
                            <p class="card-text">객실 번호 : ${dto.roomNumber}</p>
                            <p class="card-text">객실 등급 : ${dto.roomClass}</p>
                            <p class="card-text">가격     : ${dto.roomPrice}</p>
                            <p class="card-text">인원     : ${dto.roomLimit}</p>
                            <p class="card-text">${dto.description}</p>
                            <button class="btn btn-primary roomSaveButton" data-room-id="${dto.id}">예약하기</button>
                          </div>
                        </div>
                      </div>
                    </div>

            `);



                $(`.room-check .card:last-child .roomSaveButton`).off('click').on('click', function() {
                    const checkIn = document.querySelector(".checkIn").value;
                    const checkOut = document.querySelector(".checkOut").value;
                    const roomId = $(this).data('room-id');
                    axios.post('/booking/save', {
                        roomId: roomId,
                        checkIn: checkIn,
                        checkOut: checkOut
                    }).then((response) => {
                        console.log("OK")
                    }).catch((error) => {
                        console.log("fail")
                        console.log(checkIn)
                        console.log(roomId)
                    });
                });
            }
        } catch (error) {
            console.log(error);
        }
    });

</script>
<script>
    async function gettest(){
        const checkIn = document.querySelector(".checkIn").value
        const checkOut = document.querySelector(".checkOut").value
        const hotelId = $(".hotel-id").html()
        console.log(hotelId)
        const url = "/booking/available?checkIn="+checkIn+"&checkOut="+checkOut+"&hotelId="+hotelId

        const response = await axios.get(url)
        console.log(response)
        return response.data
    }
</script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

</body>
</html>
